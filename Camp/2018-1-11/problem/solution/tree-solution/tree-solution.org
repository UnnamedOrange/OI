#+TITLE: Tree Solution
#+AUTHOR: h10

大家知道什么叫做暴力美学吗?
就是用暴力来 A 一道题.

没错这题的核心思想就是暴力.
维护 $[2, n]$ 的父亲, 注意当一整个区间的父亲都是一样的时候, 我们将这个区间合并起来.

如当 =fa[]= 数组为 =fa[2]=1=, =fa[3]=1= , =fa[4]=1=, =fa[5]=4=, =fa[6]=4=, =fa[7]=2= , =fa[8]=2= 时, 我们维护的东西长这样
$$[2,3,4]\;[5,6]\;[7,8]$$

如果我们将 $[3,7]$ 的父亲赋值为 1, 将变成 
$$[2]\;[3,4,5,6,7]\;[8]$$

注意每次操作最多会切开两个断点, 每个断点处理一次就会消失, 所以哪怕暴力维护也只用搞 $O(n)$ 次.

考虑用 Splay 维护树的括号序列, 于是每次操作就变成了将 Splay 上连续的一段移动到另一个位置.
但是维护的时候要小心, 如对于这个括号序列 
#+BEGIN_SRC 
((())()) 
12332441
#+END_SRC
如果我们将 4 的父亲赋值为 2 
#+BEGIN_SRC 
((()())) 
12443321
#+END_SRC
这样就错了.
3 与 4 的顺序搞反了.

在这组数据里没有什么问题, 数据大一点就会出奇怪的问题.
正确的是这样
#+BEGIN_SRC 
((()())) 
12334421
#+END_SRC

要是你问我怎么避免, 我只能说无可奉告.
对每个点开个 =set= 记录它的儿子就好了.
当然 =set= 里的东西还得要能合并就合并.
