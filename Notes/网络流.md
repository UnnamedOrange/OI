[TOC]

# 网络流

#### 快速复习

##### 1. 最大流问题

​	最大流问题（Maximum-Flow Problem）是指这样的一个问题：在一张有向图中，假设需要把一些物品从结点 $s$（源点）运送到结点 $t$（汇点），可以从其它结点中转。每条有向边表示最多能有多少个物品从这条边的起点运送到终点，问最多能把多少物品从源点送到汇点？

​	对于一条边 (u, v)，它的物品上限称为==**容量**==（capacity），记为 c(u, v)。对于不存在的边，其容量为 0。实际运送的物品数量称为==**流量**==（flow），记为 f(u, v)。

​	在最大流问题中，要求满足三个性质：

（1）==**容量限制**==
$$
f(u, v) \le c(u, v)
$$
（2）==**斜对称性**==
$$
f(u, v) = -f(v, u)
$$
（3）==**流量平衡**==

​	对 $\forall u \in V - \{ s, t \}$，有：
$$
\sum _{(u, v) \in E} f(u, v) = 0
$$


​	我们的问题实际上是求：
$$
\max \{ \sum_{(s, v) \in E} f(s, v) \} = \max \{ \sum_{(u, t) \in E} f(u, t) \}
$$

##### 2. 增广路算法

###### ①残量网络

​	计算出每条边上的容量和流量之差（称为==**残余流量**==，简称==**残量**==），得到==**残量网络**==（residual network）。**残量网络的边数可能达到原图边数的两倍。**

###### ②增广路定理

​	残量网络中的任何一条从 $s$ 到 $t$ 的有向道路都对应一条原图中的==**增广路**==（augmenting path）。只要求出增广路中所有残量的最小值 $d$，把对应的所有边上的流量增加 $d$，就能使总流量增加 $d$，这个过程称为==**增广**==（augmenting）。

​	==**增广路定理**==指，只要残量网络中存在增广路，流量就可以增大；如果残量网络中不存在增广路，则当前流就是最大流。

###### ③最短增广路方法

​	通过不断找到增广路进行增广，最终找到最大流的方法，称之为 ==**Ford-Fulkerson 方法**==。

​	最短增广路算法指，每次沿着边数最少点的增广进行增广，可以证明，这样最多需要 $O(nm)$ 次增广。

​	如果使用 BFS 来实现，每次需要 $O(m)$ 的时间，总时间复杂度为 $O(nm^2)$，这个算法叫做 ==**Edmonds Karp 算法**==。

###### ④存边方法

​	对于最大流问题的边，要保存 4 个参数：

```c++
struct Edge
{
	int from, to, cap, flow;
}
```

​	保存边时，使用 vector 加上边集数组保存：

```c++
std::vector<Edge> edges;
std::vector<std::vector<int> > G;
```

######⑤Edmonds Karp 算法

​	Edmonds Karp 算法需要的数据如下：

（1）用于 BFS 的队列 q

（2）用于记录最大增广量的数组 opt（初始时源点为 INF，其余点为 0；这个数组也用作 vis）

（3）用于记录来自哪一条边的 pre

快速回忆：

​	如果一个点的 opt 为 0（即没有被访问过）且该边为残边，就更新它的 pre，opt，然后把它入队。

​	如果在任何时刻访问到了汇点，就停止 BFS。

​	如果在 BFS 结束后仍然没有访问到汇点，增广结束。

​	BFS 结束后，如果存在增广路，就从汇点开始，通过 pre 往回改边，直到改到 s。修改时只需要修改源边和源边的反向边的流量就可以了。

​	最后让总流量增加 opt[t]。



​	时间复杂度 $O(n m^2)$。

#### 高级内容

##### 1. Dinic 算法 —— 连续最短增广路算法

###### ①层次图

​	设在残量网络中，起点到结点 u 的最近距离为 dist(u)，我们设 level(u) = dist(u)，叫做结点的层次。若只保留从每个点出发到下一个层次的点的边，得到的图就叫做==**层次图**==。

​	因此，层次图上的任意路径都是“起点 $\to$ 层次 1 $\to$ 层次 2 $\to$ 层次 3 $\to$ …”这样的顺序。因此每条这样的路径都是 s 到 t 的最短路。

###### ②阻塞流

​	简单地说，==**阻塞流**==就是层次图的所有增广路总共可以使汇点增加的流量。

###### ③理论时间复杂度

​	Dinic 的理论时间复杂度为 $O(n^2 m)$，实际上要比这个好得多（$O(能过)$）。

​	如果所有容量均为 1，可以证明 Dinic 的时间复杂度为 $O(\min (n^{\frac {2} {3}}, m^{\frac{1}{2}}) m)$。

​	如果网络为“单位网络”[^1]，可以证明 Dinic 的时间复杂度为 $O(n^{\frac {1} {2}} m)$。

[^1]: 除了源点和汇点之外，每一个点要么只有一条入弧，且容量为 1，要么只有一条出弧，且容量为 1，其它弧的容量为任意整数，这样的网络成为单位网络。例如二分图最大匹配的网络就是单位网络。 

###### ④实现

​	