[TOC]

# 生成函数

##基础

##### 1. 泰勒公式

&emsp;&emsp;当 $x \to x_0$ 时：
$$
f(x) = f(x_0) +
\frac {f'(x_0)} {1!} (x - x_0) +
\frac {f^{(2)}(x_0)} {2!} (x - x_0)^2 +
\cdots +
\frac {f^{(n)}(x_0)} {n!} (x - x_0)^n +
o((x - x_0)^n)
$$
&emsp;&emsp;当 $x_0 = 0$ 时：
$$
f(x) = 
f(0) +
\frac {f'(0)} {1!} x +
\frac {f^{(2)}(0)} {2!} x^2 +
\cdots +
\frac {f^{(n)}(0)} {n!} x^n +
o(x^n)
$$

##### 2. 泰勒展开的例子

$$
(e^x)^{(n)} = e^x
\\
e^x =
1 + \frac {x} {1!} + \frac {x^2} {2!} + \frac {x^3} {3!}
+ \cdots + \frac {x^n} {n!} + \cdots
$$

$$
\sin(x) = x - \frac {x^3} {3!}
+ \frac {x^5} {5!}
+ \cdots
+ (-1)^n \frac {x^{2n + 1}} {(2n + 1)!}
+ \cdots
$$

$$
\cos(x) = 1 - \frac {x^2} {2!}
+ \frac {x^4} {4!}
+ \cdots
+ (-1)^n \frac {x^{2n}} {(2n)!}
+ \cdots
$$

$$
\ln(1 + x) = \frac {x} {1}
- \frac {x^2} {2}
+ \frac {x^3} {3}
+ \cdots
+ (-1)^{n + 1} \frac {x^n} {n}
+ \cdots
$$

$$
(1 + x)^a = 1 + \frac {a} {1!} x
+ \frac {a(a - 1)} {2!} x^2
+ \cdots
+ \frac {a (a - 1) \cdots (a - n + 1)} {n!} x^n
+ \cdots
$$

## 普通生成函数

####基础

##### 1. 定义

&emsp;&emsp;我们有一个序列 $\{ a_n, a_1, a_2, a_3, \cdots \}$，希望能将它们整体表示出来。除了直接写出这个序列，还可以这样做：将序列元素作为系数，放在函数里：
$$
A(x) = \sum_{k = 0}^{\infty} a_k x^k
$$
&emsp;&emsp;称 $A(x)$ 为序列的普通生成函数（Ordinary Generating Function，OGF）。

##### 2. 例子

&emsp;&emsp;最常见的 Taylor 公式：
$$
e^x = 1 + x + \frac {x^2} {2} + \frac {x^3} {6} + \frac {x^4} {24}
+ \cdots + \frac {x^n} {n!} + \cdots
$$
&emsp;&emsp;所以 $e^x$ 可以表示：
$$
1, 1, \frac {1} {2}, \frac {1} {6}, \frac {1} {24},
\cdots, \frac {1} {n!}, \cdots
$$

##### 3. 全是 $1$ 的序列

&emsp;&emsp;可以用 $1 + x + x^2 + x^3 + \cdots$ 表示全部是 $1$ 的序列。那对于这个多项式，有没有什么化简的办法呢？

&emsp;&emsp;设 $S = 1 + x + x^2 + x^3 + \cdots$，有：
$$
\begin{align}
S = 1 + &x + x^2 + x^3 + \cdots
\\
-xS = -(&x + x^2 + x^3 + \cdots)
\end{align}
$$
&emsp;&emsp;易得：
$$
(1 - x)S = 1
$$
&emsp;&emsp;即：
$$
S = \frac {1} {1 - x}
$$
&emsp;&emsp;于是我们可以用 $\frac {1} {1 - x}$ 表示全部是 $1$ 的序列。

------

&emsp;&emsp;可以对 $\frac {1} {1 - x} = (1 - x)^{-1}$ 进行泰勒展开：
$$
(1 - x)^a =
1 - \frac {a} {1!} x + \frac {a(a - 1)} {2!}x^2
- \frac {a(a - 1)(a - 2)} {3!} x^3
+ \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {1} {1 - x}
= 1 + x + x^2 + x^3 + \cdots
$$

##### 4. 等比数列

&emsp;&emsp;既然 $\frac {1} {1 - x}$ 代表全是 $1$ 的序列，那 $\frac {1} {1 + x}$ 呢？
$$
(1 + x)^a = 1 + \frac {a} {1!} x
+ \frac {a(a - 1)} {2!} x^2
+ \frac {a(a - 1)(a - 2)} {3!} x^3
+ \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {1} {1 + x}
= 1 - x + x^2 - x^3 + \cdots
$$
&emsp;&emsp;所以 $\frac {1} {1 + x}$ 代表的序列为：
$$
1, -1, 1, -1, \cdots
$$

------

&emsp;&emsp; $\frac {1} {1 - 3x}$ 代表什么呢？
$$
(1 - 3x)^a = 1 - \frac {3a} {1!} x
+ \frac {27a(a - 1)} {2!}
- \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {1} {1 - 3x} = 1 + 3x + 27x^2 + \cdots
$$
&emsp;&emsp;得到的序列为：
$$
1, 3, 9, 27, 
\cdots, 3^n, \cdots
$$

------

&emsp;&emsp;$\frac {2} {1- x}$ 代表什么呢？
$$
2(1-x)^a = 2 - \frac {2a} {1!} x
+ \frac {2a(a - 1)} {2!}
- \frac {2a(a - 1)(a - 2)} {3!}
+ \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {2} {1 - x} = 2 + 2x + 2x^2 + 2x^3 + \cdots
$$
&emsp;&emsp;得到的序列为：
$$
2, 2, 2, 2, \cdots
$$

------

&emsp;&emsp;**一般地，对于一个首项为 $a$，公比为 $q$ 的等比数列，它的生成函数为：**
$$
A = \frac {a} {1 - qx}
$$

##### 5. 每两个数之间存在 $k$ 个 $0$ 的序列

&emsp;&emsp;对于序列：
$$
1, 0, 1, 0, 1, 0, \cdots
$$
&emsp;&emsp;可以得到它的生成函数：
$$
A = 1 + x^2 + x^4 + x^6 + \cdots
$$
&emsp;&emsp;同乘以 $x^2$ 得到：
$$
x^2 A = x^2 + x^4 + x^6 + \cdots
$$
&emsp;&emsp;相减得：
$$
(1 - x^2) A = 1
\\
A = \frac {1} {1 - x^2}
$$

------

&emsp;&emsp;对于序列：
$$
1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, \cdots
$$

$$
A = 1 + x^4 + x^8 + \cdots
\\
x^4 A = x^4 + x^8 + \cdots
\\
A = \frac {1} {1 - x^4}
$$

&emsp;&emsp;**一般地，对于一个第一个数为 $1$，每两个 $1$ 之间存在 $k$ 个 $0$ 的 $01$ 序列，它的生成函数为：**
$$
A = \frac {1} {1 - x^{k + 1}}
$$

##### 6. 在序列前补 $0$

&emsp;&emsp;要在序列前补$k$ 个 $0$，只需要让生成函数乘以 $x^k$：
$$
A = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \cdots
\\
x^2 A = 0 + 0 x + a_0 x^2 + a_1 x^3 + a_2 x^4 + \cdots
$$

------

&emsp;&emsp;**一般地，对于一个首项为 $a$，公比为 $q$ 的等比数列，每个数之间插入了 $k$ 个 $0$，在序列的最前面插入了 $t$ 个 $0$，则它的生成函数为：**
$$
A = x^t \frac {a} {1 - q x^{k + 1}}
$$

#####7. 生成函数的加法 

$$
\frac {1} {1 - x^2} + \frac {x} {1 - x^2} = \frac {1} {1 - x}
$$

$$
\begin {align}
&~1, 0, 1, 0, 1, 0, \cdots
\\
+&~0, 1, 0, 1, 0, 1, \cdots
\\
=&~1, 1, 1, 1, 1, 1, \cdots
\end {align}
$$

&emsp;&emsp;生成函数可以进行加法运算，实质上是多项式加法。

#####8. 生成函数的前缀和与差分

&emsp;&emsp;如果有生成函数 $A$：
$$
A = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \cdots
$$
&emsp;&emsp;可以做如下变换：
$$
A = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \cdots
\\
xA = 0 + a_0 x + a_1 x^2 + a_2 x^3 + \cdots
\\
(1 - x)A = (a_0 - 0)  + (a_1 - a_0)x + (a_2 - a_1)x^2 + (a_3 - a_2)x^3 + \cdots
$$
&emsp;&emsp;**即：对于生成函数，乘以一个 $(1 - x)$ 相当于做了一次差分，除以一个 $(1 - x)$ 相当于做了一次前缀和。**

&emsp;&emsp;**特别地，对于生成函数，除以一个 $(1 - x^{k + 1})$ 相当于每个数与它前面的倒数第 $k$ 个数做前缀和。**

------

&emsp;&emsp;可以得到公式：
$$
(1 - x)^{-k} = \sum_{n = 0}^{\infty} C_{n + k - 1}^{k - 1} x^n
= 1 + C_k^{k - 1} x + C_{k + 1}^{k - 1} x + \cdots + C_{n + k - 1}^{k - 1} x^n + \cdots
$$

------

&emsp;&emsp;e.g. 求完全平方数的生成函数 $1, 4, 9, 16, \cdots$

&emsp;&emsp;解：对完全平方数做差分，我们有：
$$
1, 3, 5, 7, \cdots
$$
&emsp;&emsp;再做差分，我们有：
$$
1, 2, 2, 2, \cdots
$$
&emsp;&emsp;再做差分，我们有：
$$
1, 1, 0, 0, \cdots
$$
&emsp;&emsp;易得该序列的生成函数为 $1 + x$。即原序列的生成函数为 $\frac {1 + x} {(1 - x)^3}$。

##### 9. 练习

$$
4, 4, 4, 4, 4, \cdots \tag{1}
$$

$$
A = \frac {4} {1 - x}
$$


$$
2, 4, 6, 8, 10, \cdots \tag {2}
$$

$$
A = \frac {2} {(1 - x)^2}
$$


$$
0, 0, 0, 2, 4, 6, 8, 10, \cdots \tag {3}
$$

$$
A = \frac {2x^3} {(1 - x)^2}
$$


$$
1, 5, 25, 125, \cdots \tag {4}
$$

$$
A = \frac {1} {1 - 5x}
$$


$$
1, -3, 9, -27, 81, \cdots \tag{5}
$$

$$
A = \frac {1} {1 + 3x}
$$


$$
1, 0, 5, 0, 25, 0, 125, 0, \cdots \tag {6}
$$

$$
A = \frac {1} {1 - 5x^2}
$$

$$
0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, \cdots \tag{7}
$$

$$
A = \frac {x} {(1 - x^3)^2}
$$

$$
4, 5, 7, 10, 14, 19, 25, \cdots \tag {8}
$$

$$
A = \frac {4} {1 - x} + \frac {x} {(x - 1)^3}
$$

##### 10. 线性递推式的生成函数

&emsp;&emsp;根据斐波那契数列的定义，我们有：
$$
a_n = a_{n - 1} + a_{n - 2}
$$
&emsp;&emsp;可以写出它的生成函数：
$$
\begin{gather}
A = 1 + 1x + 2x^2 + 3x^3 + 5x^4 + 8x^5 + \cdots
\\
xA = 0 + 1x + 1x^2 + 2x^3 + 3x^4 + 5x^5 + \cdots
\\
x^2A = 0 + 0x + 1x^2 + 1x^3 + 2x^4 + 3x^5 + \cdots
\\
(1 - x - x^2)A = 1
\\
A = \frac {1} {1 - x - x^2}
\end{gather}
$$

------

&emsp;&emsp;e.g. 求 $a_n = 3a_{n - 1} - 2a_{n - 2}$ 的生成函数。其中 $a_0 = 1$，$a_1 = 3$。

&emsp;&emsp;解：
$$
A = \frac {1} {1 - 3x + 2x^2}
$$

##### 11. 使用生成函数计算线性递推式的通项公式

&emsp;&emsp;我们已经得到了斐波那契数列的生成函数：
$$
A = \frac {1} {1 - x - x^2}
$$
&emsp;&emsp;如果能将其写成如下形式：
$$
A = \sum_{i} \frac {a_i} {1 - q_ix}
$$
&emsp;&emsp;则能将其表示为数个等比数列的和，也就得到了通项公式。

------

&emsp;&emsp;可以设：
$$
\frac {1} {1 - x - x^2} = \frac {a} {1 - \phi_1 x} + \frac {b} {1 - \phi_2 x}
$$
&emsp;&emsp;其中：
$$
1 - x - x^2 = (1 - \phi_1 x) (1 - \phi_2 x)
$$
&emsp;&emsp;可以得到：
$$
\phi_1 = \frac {1 + \sqrt 5} {2}
\\
\phi_2 = \frac {1 - \sqrt 5} {2}
$$
&emsp;&emsp;代入解得：
$$
a = \frac {\phi_1} {\sqrt 5}
\\
b = - \frac {\phi_2} {\sqrt 5}
$$
&emsp;&emsp;则可以将斐波那契数列写作两个等比数列相加的形式。

-----

&emsp;&emsp;一般地，若要使用生成函数求通项公式，可以利用特殊生成函数对应的序列结合生成函数的加法和乘法进行求解。

##### 12. 组合数与生成函数

&emsp;&emsp;设 $A(x) = (1 + x)^n$，由二项式定理，有：
$$
A(x) = C_n^0 + C_n^1 x + C_n^2 x^2 + \cdots + C_n^n x^n
$$
&emsp;&emsp;即 $A(x)$ 为 $\{ C_n^k \}$ 的生成函数。

#### 普通生成函数与组合计数问题

##### 1. 加法原理和乘法原理

&emsp;&emsp;将 $i$ 次项系数 $a_i$ 看作组合问题中选取问题规模[^问题规模]为 $i$ 的方案数。则对于两个普通生成函数的加法，则对应加法原理：
$$
C = A + B = \sum_{n = 0}^{\infty} (a_n + b_n)x^n
$$
&emsp;&emsp;对于生成函数的乘法，对应乘法原理：
$$
C = A × B = \sum_{n = 0}^{\infty} (\sum_{i = 0}^{n} (a_i × b_{n - i}))
$$
&emsp;&emsp;**注意到，OGF 中我们的指数代表的是物品的个数，也就是说同种物品是无标号的，所以说普通生成函数适用于无标号的计数问题。**

[^问题规模]: 比如物品的个数就是问题规模。

------

&emsp;&emsp;e.g. 有 A，B，C，D 四种水果，每种水果都有无限个。现在要求每种水果拿若干个，要求 A 恰好拿出偶数个，B 恰好拿出 5 的倍数个，C 最多拿 4 个，D 最多拿 1 个，如果最后恰好拿出 $n$ 个水果，有多少种方案。

&emsp;&emsp;解：设 $G$ 为方案数的生成函数，A，B，C，D 分别为只拿某种水果的生成函数，则有：
$$
A = \frac {1} {1 - x^2}
\\
B = \frac {1} {1 - x^5}
\\
C = 1 + x + x^2 + x^3 + x^4
\\
D = 1 + x
$$

$$
G = A × B × C × D
\\
G = \frac {1} {1 - x^2} · \frac {1} {1 - x^5} · \frac {1 - x^5} {1 - x} · (1 - x)
=
\frac {1} {(1 - x)^2}
$$

&emsp;&emsp;即 $G$ 对应的序列为 $1, 2, 3, 4, 5, \cdots$，所以恰好选取 $n$ 个水果的方案数为 $n + 1$。

##### 2. 将 $n$ 个物品放进 $m$ 个不同盒子的方案数

&emsp;&emsp;设 $A(x) = \frac {1} {(1 - x)^m}$，有：
$$
A(x) = \mathrm C_{m + i - 1}^{m - 1} x^i
$$
&emsp;&emsp;为什么是这样呢？

&emsp;&emsp;可以将 $\frac {1} {1 - x}$ 看作一个价值为 $i$ 的物品各有一个的集合，原式相当于是在 $m$ 个这样的集合中各选一个物品时总价值为 $i$ 的方案数，也就相当于将 $n$ 拆分成 $m$ 个非负整数的方案数，即 $\mathrm C_{m + i - 1}^{m - 1}$。

##### 3. 卡特兰数

&emsp;&emsp;一个正 $n$ 边形，画 $n - 3$ 条不相交的对角线将它划分成一些三角形，有多少种方案？

&emsp;&emsp;方案数被称为 Catalan 数，前几项为 $1, 2, 5, 14, 42, \cdots$。

###### ①递推式

$$
c_n = \sum_{i = 0}^{n - 1} c_i c_{n - i - 1}
$$

&emsp;&emsp;这是一个非线性的递推式，其生成函数为：
$$
G(x) = 1 + 1 x + 2 x^2 + 5 x^3 + 14 x^4 + 42 x^5 + \cdots
$$

######②生成函数

&emsp;&emsp;注意到，卡特兰数的递推式是一个类似于卷积的东西，而多项式乘法也是一个卷积。设多项式次数为 $n$ 的项的系数为 $c_n$，则**当多项式相乘时**，对于相乘的结果的 $n$ 次项系数 $c'_n$ 有：
$$
c'_n = \sum_{i = 0}^{n} c_i c_{n - i}
$$
&emsp;&emsp;这个和式与递推是的唯一区别是：计算系数 $c'_n$ 时会用到 $c_n$，而计算递推式时，计算 $c_n$ 时不能用到 $c_n$。

&emsp;&emsp;但是这并不影响它们间的相似性，事实上，如果我们计算 $G^2$，那么它的系数 $c'_i$ 就是卡特兰数的 $c_{i + 1}$。所以有：
$$
G = 1 + xG^2
$$
&emsp;&emsp;解得：
$$
G(x) = \frac {1 ± \sqrt{1 - 4x}}{2x}
$$
&emsp;&emsp;**如果 $G(x) = \frac {1 + \sqrt{1 - 4x}}{2x}$，当 $x \to 0$ 时，$G(x) \to \infty$，而展开式并不是无穷大，所以舍去。**因此，卡特兰数的生成函数是：
$$
G(x) = \frac {1 - \sqrt{1 - 4x}}{2x}
$$

## 指数型生成函数

#### 基础

##### 1. 定义

&emsp;&emsp;对于序列 $\{ a_i \}$，称
$$
\hat P = a_0 + \frac {a_1} {1!} x + \frac {a_2} {2!} x^2 + \frac {a_3} {3!} + \cdots
$$
为序列的指数型生成函数（Exponential Generating Function，EGF）。

&emsp;&emsp;**指数型生成函数常用来解决有标号的问题。**

------

e.g. $e^x = 1 + \frac {x} {1!} + \frac {x^2} {2!} + \frac {x^3} {3!} + \cdots$

&emsp;&emsp;则 $e^x$ 为序列 $1, 1, 1, 1, \cdots$ 的生成函数。

##### 2. $n$ 个不同元素的排列数

&emsp;&emsp;有 $n$ 个不同元素的排列数为 $n!$，如何使用生成函数来表示它呢？
$$
\hat C = \sum_{n = 0}^{\infty} \frac {n!} {n!} x^n
$$
&emsp;&emsp;化简得：
$$
\hat C = \frac {1} {1 - x}
$$
&emsp;&emsp;即 $\{ n! \}$ 的指数型生成函数为 $\frac {1} {1 - x}$。

#### 指数型生成函数与组合计数

##### 1. 带标号对象的拼接

e.g. 有两个大小为 $n$ 和 $m$ 的集合，且它们的交集为空。已知大小为 $n$ 的集合可能有 $f_n$ 种，大小为 $m$ 的集合可能有 $f_m$ 种，求它们的并集可能有多少种。

&emsp;&emsp;如果我们非要使用生成函数，则前者为 $A(x) = f_n x^n$，后者为 $B(x) = f_m x^m$，将它们相乘即可。

------

e.g. 有两个大小为 $n$ 和 $m$ 的排列，且它们的元素的交集为空。已知大小为 $n$ 的排列可能有 $f_n$ 种，大小为 $m$ 的排列可能有 $f_m$ 种，求把它们合起来组成一个大小为 $n + m$ 的排列有多少种？要求新排列中一个元素对应的原排列。

&emsp;&emsp;相当于是要在 $n + m$ 个位置中选出 $n$ 个位置放置前者。但是它的生成函数是？

------

&emsp;&emsp;指数型生成函数的一个功能便是带标号对象的拼接，也就是上面的第二个问题。设原来的生成函数分别为 $\hat A$ 和 $\hat B$，并且设我们要求的生成函数为 $C$，那么有：
$$
\begin{align*}
c_i =&
\sum_{j = 0}^{i} \mathrm{C}_{i}^{j} a_j b_{i - j}
\\=&
\sum_{j = 0}^{i} \frac {i!} {j! (i - j)!} (j! \cdot \hat A_{j}) ((i - j)! \cdot \hat B_{i - j})
\\=&
i! \sum_{j = 0}^{i} \hat A_j \hat B_{i - j}
\end{align*}
$$
其中 $\hat F_i$ 表示指数型生成函数 $\hat F$ 次数为 $i$ 的项的系数。

&emsp;&emsp;如果 $C$ 也是个指数型生成函数，那么我们就有：
$$
\hat C_i = \sum_{j = 0}^{i} \hat A_j \hat B_{i - j}
$$
&emsp;&emsp;也就是说，指数型生成函数正好解决了带标号对象的拼接，结果就是原来的两个指数型生成函数的卷积。

##### 2. 环排列

&emsp;&emsp;设 $n$ 个元素的环排列个数为 $c_n$，其生成函数为：
$$
\hat C = \sum_{n = 1}^{\infty} \frac {(n - 1)!} {n!} x^n
= \sum_{n = 1}^{\infty} \frac {x^n} {n}
$$

------

&emsp;&emsp;[将 $\ln(1 + x)$ 泰勒展开](#2.-泰勒展开的例子)，我们有：
$$
\ln(1 + x) = \frac {x} {1}
- \frac {x^2} {2}
+ \frac {x^3} {3}
+ \cdots
+ (-1)^{n + 1} \frac {x^n} {n}
+ \cdots
$$
&emsp;&emsp;代入 $x = -1$，可以得到：
$$
-\ln(1 - x) = \frac {x} {1}
+ \frac {x^2} {2}
+ \frac {x^3} {3}
+ \cdots
+ (-1)^{n + 1} \frac {x^n} {n}
+ \cdots
$$
&emsp;&emsp;即：
$$
\hat C = \ln (\frac {1} {1 - x}) = \ln(\hat P)
$$

&emsp;&emsp;等价于：
$$
\hat P = e^{\hat C}
$$

##### 3. 循环

&emsp;&emsp;任何排列都可以拆分成一些循环[^循环]，可以理解为拆分成几个环排列。我们的任务是：计算由 $k​$ 个循环组成的排列的数量的生成函数 $\hat Q​$。

[^循环]: permutation cycle

&emsp;&emsp;最简单的情况是 $k = 1$ 的情况，此时 $\hat Q = \hat C$。

&emsp;&emsp;当 $k = 2$ 时：
$$
q_n = \frac {1} {2!} \sum_{t = 0}^{n}
( \begin{matrix} n \\ t \end{matrix} )
c_t c_{n - t}
$$
&emsp;&emsp;相当于是选 $t$ 个出来做一次圆排列（一个循环），剩下的 $n - t$ 个又做一次圆排列，最后消序。

&emsp;&emsp;写出 $\hat Q$ 并化简：
$$
\begin{align}
\hat Q(x)
&= \frac {1} {2!} \sum_{n = 0}^{\infty} \frac {q_n} {n!} x^n
\\
&= \frac {1} {2!} \sum_{n = 0}^{\infty} \frac {1} {n!} (\sum_{t = 0}^{n} \frac {n!} {t! (n - t)!} c_t c_{n - t}) x^n
\\
&= \frac {1} {2!} \sum_{t = 0}^{\infty} \frac {c_t} {t!} x^t · \sum_{s = 0}^{\infty} \frac {c_s} {s!}x^s \qquad (s = n - t)
\\
&= \frac {1} {2!} \hat C · \hat C
\\
&= \frac {1} {2!} \hat C^2
\end{align}
$$

------

&emsp;&emsp;可以发现由 $k$ 个循环组成的排列的数量的生成函数为 $\frac {1} {k!} \hat C^k$，所以得到了排列的生成函数：
$$
\hat P = \sum_{k = 1}^{\infty} \frac {1} {k!} \hat C^k
$$
&emsp;&emsp;又因为：
$$
e^x =  1 + \frac {x} {1!} + \frac {x^2} {2!} + \frac {x^3} {3!} +\cdots
$$
&emsp;&emsp;所以可以得到：
$$
\hat P = e^{\hat C}
$$
&emsp;&emsp;印证了：
$$
\hat C = \ln (\hat P)
$$

------

&emsp;&emsp;$\hat P$ 和 $\hat C$ 到底有什么关系呢？

&emsp;&emsp;**$\hat C$ 是单个循环的生成函数，$\hat C$ 的幂除以阶乘代表将多个循环凑成一个集合，$e^{\hat C}$ 代表将不限个数个循环凑成集合的总方案，即 $\hat P$。**

##### 4. 错排问题

&emsp;&emsp;错排是指一个排列，且 $\forall i$，$i$ 不在第 $i$ 个位置上。换句话说，错排不允许有大小为 1 的循环。

&emsp;&emsp;大小为 $k$ 的循环的生成函数为：
$$
\hat C = \ln(\frac {1} {1 - x})
$$

&emsp;&emsp;不允许出现大小为 1 的循环的生成函数为：
$$
\ln(\frac {1} {1 - x}) - x
$$
&emsp;&emsp;将这种循环凑成集合排列的生成函数为：
$$
\hat D = e^{\ln(\frac {1} {1 - x}) - x} = \frac {e^{-x}} {1 - x}
$$

##### 5. 有标号无向连通图计数

&emsp;&emsp;如何使用生成函数求 $n$ 个点的有标号无向连通图（无重边自环）？

&emsp;&emsp;令 $\hat A$ 表示有标号无向连通图的生成函数，$\hat B$ 表示有标号无向图的生成函数，易得：
$$
\hat B = \sum_{i = 0}^{\infty} 2^{\mathrm{C} (i, 2)} x^i
$$
&emsp;&emsp;由于无向图可以看做 $k$ 个无向连通图凑合而成，因此有：
$$
\hat B = e^{\hat A}
\\
\hat A = \ln(\hat B)
$$

## 多项式算法

