[TOC]

# 数论函数

#### 数论函数

#####1. 定义

&emsp;&emsp;把定义域为正整数，陪域[^陪域]为复数的函数称为数论函数。~~所以说我们研究的范围可广了……~~

[^陪域]: 包含值域的任意集合，称为陪域。

##### 2. 记号

######艾弗森约定

&emsp;&emsp;将真或假的命题 $P(k)$ 放在方括号中。当命题 $P(k)$ 为真时，命题的结果为 1；为假时，结果为 0。这种表示方法叫作艾弗森约定。
$$
[命题 \, k] = 
\left\{\begin{matrix}
0, \, k \, 为假
\\
1, \, k \, 为真
\end{matrix}\right.
$$

####积性函数

##### 1. 定义

&emsp;&emsp;积性函数：对于**任意互质的整数** $a$ 和 $b$ 有 $f(ab) = f(a) f(b)$ 的数论函数，称为积性函数。

&emsp;&emsp;完全积性函数：对于**任意整数** $a$ 和 $b$ 有 $f(ab) = f(a) f(b)$ 的数论函数，称为完全积性函数。

##### 2. 常见积性函数

###### ①Dirichlet 卷积单位元

$$
\epsilon(n)
\\
\epsilon(n) = [n = 1]
$$

&emsp;&emsp;Dirichlet 卷积单位元将在 Dirichlet 卷积中介绍。

###### ②常函数

$$
1(n)
\\
1(n) = 1
$$

&emsp;&emsp;常函数是完全积性函数。

&emsp;&emsp;常函数也写作 $1$。

###### ③恒等函数

$$
id(n)
\\
id(n) = n
$$

&emsp;&emsp;恒等函数是完全积性函数。

###### ④欧拉函数

$$
\varphi(n)
\\
\varphi(n) = \sum _{i = 1} ^{n} [\gcd(i, n) = 1]
$$

###### ⑤除数函数

$$
\sigma_k(n)
\\
\sigma_k(n) = \sum _{d \mid n} d^k
$$

&emsp;&emsp;$\sigma_0(n)$ 表示 $n$ 的正因子数目，也记为 $d(n)$。

&emsp;&emsp;$\sigma_1(n)$ 表示 $n$ 的正因子之和，也记为 $\sigma(n)$。

###### ⑥莫比乌斯（Möbius）函数[^Möbius]

[^Möbius]: 莫比乌斯函数的更多内容将在下文提及。

$$
\mu(n)
\\
\mu(n) = 
\left\{\begin{matrix}
0 \;\;\;\;\;\;\;\; \exists d > 1, \, d^2 \mid n
\\
1 \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\, n = 1
\\
(-1)^k \;\;\;\;\;\;\;\; n = \prod _{i = 1} ^ {k} p_i
\end{matrix}\right.
$$

&emsp;&emsp;当 $n = 1$ 时，$\mu(n) = 1$；当 $n$ 存在一个质因子的指数大于等于 2 时，$\mu(n) = 0$；否则，当 $n$ 有奇数个质因子时，$\mu(n) = -1$；当 $n$ 有偶数个质因子时，$\mu(n) = 1$。

​	$n = 1$ 的情况可以归类到 $n$ 有偶数个质因子的情况。

##### 3. 积性的定理

######①积性函数的充要条件

&emsp;&emsp;设 $f(n)$ 是不恒为零的数论函数，$n = p_1^{a_1} p_2^{a_2} ... p_r^{a_r}$。

&emsp;&emsp;$f(n)$ 是积性函数的充要条件是 $f(1) = 1$ 且 $f(n) = f(p_1^{a_1}) f(p_2^{a_2}) ... f(p_r^{a_r})$。

&emsp;&emsp;$f(n)$ 是完全积性函数的充要条件是 $f(1) = 1$ 且 $f(n) = f^{a_1}(p_1) f^{a_2}(p_2) ... f^{a_r}(p_r)$。

###### ②莫比乌斯变换[^莫比乌斯变换]

[^莫比乌斯变换]: 莫比乌斯变换的更多内容将在下文提及 

&emsp;&emsp;定义
$$
F(n) = \sum _{d \mid n} f(d)
$$

称 $F$ 为 $f$ 的莫比乌斯变换。

&emsp;&emsp;定理：**若 $f(n)$ 为积性函数，则 $\sum_{d \mid n} f(d)$ 也为积性函数。**

>   证明
>
>   >   Lemma
>   >
>   >   定义
>   >   $$
>   >   f(n) = \sum _{i_1 = 1}^{a_1} \sum _{i_2 = 1}^{a_2} ... \sum _{i_r = 1}^{a_r} f_1(s_{1, i_1}) f_2(s_{2, i_2}) ... f_r(s_{r, i_r})
>   >   $$
>   >   可以得到
>   >   $$
>   >   f(n) = \prod _{j = 1} ^ {r} (\sum _{i = 1} ^{a_j} f_j(s_{j, i}))
>   >   $$
>   >
>
>   &emsp;&emsp;可以将 $F(n)$ 表示为
>   $$
>   F(n) = \sum_{e_1 = 0}^{a_1} \sum_{e_2 = 0}^{a_2} ... \sum_{e_r = 0}^{a_r} f(p_1^{e_1}) f(p_2^{e_2}) ... f(p_r^{e_r})
>   $$
>   &emsp;&emsp;由引理，可知
>   $$
>   F(n) = F(p_1^{e_1}) F(p_2^{e_2}) ... F(p_r^{e_r})
>   $$
>   &emsp;&emsp;得证！

##### 4. 欧拉函数

###### ①性质

$$
\varphi(p^a) = p^a - p^{a - 1}
\\
\varphi(ab) = \varphi(a) \phi(b) \frac {\gcd(a, b)} {\varphi(\gcd(a, b))} = \varphi(lcm(a, b)) \varphi(\gcd(a, b))
$$

###### ②欧拉函数线性筛

​	使用欧拉筛法用最小的因子去筛，时间复杂度为 $O(n)$。

&emsp;&emsp;当 $i$ 为质数时，$\varphi(i)$ 为 $i - 1$；当 $i$ 与 $k$ 互质时，$\varphi(ki) = \varphi(i) × \varphi(k) = \varphi(i) × (k - 1)$；当 $i$ 与 $k$ 不互质且 $k$ 是 $i$ 的最小质因子时，$\varphi(ki) = \varphi(k) \varphi(i) \frac {gcd(k, i)} {\varphi(gcd(k, i))} = \varphi(k) \varphi(i) \frac {k} {\varphi(k)} = \varphi(i) × k$。

##### 5. 广义欧拉筛

&emsp;&emsp;广义欧拉筛指，使用欧拉筛法求出各种数论函数，而不仅仅局限于筛出素数或者欧拉函数。

&emsp;&emsp;例如，可以使用欧拉筛计算莫比乌斯函数：

```c++
mu[1] = 1;
//...
	if(!isntPrime[i]) mu[i] = -1;
//...
		if(!(i % prime[j])) mu[i * prime[j]] = 0;
		else mu[i * prime[j]] = -mu[i];
```

##### 6. 狄利克雷（Dirichlet）卷积

###### ①定义

&emsp;&emsp;设数论函数 $f$，$g$，则它们的狄利克雷卷积可以表示为 $f * g$。

​	设 $h = f * g$，有：
$$
h(n) = (f * g)(n) = \sum _{d \mid n} f(n) g(\frac {n} {d})
$$
&emsp;&emsp;称 $h$ 为 $f$ 和 $g$ 的狄利克雷卷积。

###### ②运算律

&emsp;&emsp;狄利克雷卷积的运算律不要求证明。

&emsp;&emsp;（1）交换律：$f * g = g * f$

&emsp;&emsp;（2）结合律：$(f * g) * h = f * (g * h)$

&emsp;&emsp;（3）单位元

&emsp;&emsp;&emsp;&emsp;若有数论函数 $h$ 对于所有的数论函数 $f$，均有 $f * h = h * f = f$，称 $h$ 为单位数论函数，或称之为卷积单位元。

&emsp;&emsp;&emsp;&emsp;**通过验证不难得到，狄利克雷卷积的单位元为 $\epsilon$。**

###### ③积性

&emsp;&emsp;若 $f$ 和 $g$ 均为积性函数，则 $f * g$ 为积性函数；反之，若 $g$ 和 $f * g$ 均为积性函数，则 $f$ 为积性函数。

###### ④举例

$$
d(n) = \sum _{d \mid n} 1
\\
d = 1 * 1
$$



$$
\sigma(n) = \sum _{d \mid n} d
\\
\sigma = id * 1
$$



$$
\sum _{d \mid n} \mu(d) = \epsilon(n)
\\
\mu * 1 = \epsilon
$$
&emsp;&emsp;上式为莫比乌斯等式，将在下文讲解。



$$
\sum _{d \mid n} \varphi(d) = n
\\
\varphi * 1 = id
$$

>   证明
>
>   ​	当 $m = p^a$ 时，有
>   $$
>   \sum _{d \mid p^a} \varphi(d) = \varphi(1) + \varphi(p) + \varphi(p^2) + ... + \varphi(p^a) = p^a
>   $$
>   ​	由该函数的积性，可推出原式，得证！



$$
\varphi(n) = \sum_{d \mid n} \mu(d) \frac {n} {d}
\\
\varphi = \mu * id
$$

>证明
>
>&emsp;&emsp;这里利用卷积的性质来证明。
>
>&emsp;&emsp;等式两边同乘以 $1$ 得 $\varphi(n) * 1 = \mu * 1 * id$。
>
>&emsp;&emsp;由莫比乌斯等式和 $\varphi * 1 = id$，可以得到
>$$
>id = \epsilon * id
>$$
>&emsp;&emsp;得到一恒等式（$\epsilon$ 是单位元），得证！
>
>
>
>&emsp;&emsp;也可以使用一般的方法来证明。
>
>>   Lemma
>>
>>   &emsp;&emsp;设可重集 $A$，设 $A_d = \{ a | a \in A, d \mid a \}$，对于一正整数 $K$，我们有：
>>   $$
>>   \sum _{a \in A} [gcd(a, K) = 1] = \sum _{d | K} \mu(d) × |A_d|
>>   $$
>>   证明
>>   $$
>>   \sum _{a \in A}[gcd(a, K) = 1]
>>   \\
>>   = \sum _{a \in A} \sum _{d | gcd(a, K)} \mu(d)
>>   $$
>>   &emsp;&emsp;这个等号由莫比乌斯等式得来。
>>
>>   &emsp;&emsp;考虑**枚举公约数**。因为我们这里求的是**最大公约数的约数，实际上就是公约数**。
>>
>>   &emsp;&emsp;公约数一定是 $K$ 的约数，设为 $d$。发现，若有 $d \mid a$，则 $a$ 会对 $\mu(d)$ 有 $1$ 的**贡献**。结合 $A_d$ 的定义，我们有：
>>   $$
>>   \sum _{d | K} (\mu(d) \sum _{a \in A} [d \mid a]) =  \sum _{d | K} \mu(d) × |A_d|
>>   $$
>>   &emsp;&emsp;得证！
>
>&emsp;&emsp;设 $A = \{ 1, 2, ..., n \}$，有
>$$
>\varphi(n) = \sum _{a \in A} [gcd(a, N) = 1]
>$$
>&emsp;&emsp;由引理，得
>$$
>\varphi(n) = \sum _{d | n} \mu(d) × |A_d| = \sum_{d \mid n} \mu(d) \frac {n} {d}
>$$
>&emsp;&emsp;得证！	

#### 莫比乌斯反演

#####1. 莫比乌斯等式

$$
\sum _{d \mid n} \mu(d) = \epsilon(n)
\\
\mu * 1 = \epsilon
$$

&emsp;&emsp;$\epsilon$ 为单位函数。

###### ①证明

&emsp;&emsp;当 $n = 1$ 时，答案显然成立。

&emsp;&emsp;当 $n > 1$ 时，$n = \prod_i^k p_i^{a_i}$。

&emsp;&emsp;则有
$$
\forall_{d \mid n, \mu(d) \ne 0} d = \prod_{i \in I} p_i, \, I \subseteq \{ 1, 2, ... , k \}
$$
&emsp;&emsp;相当于在 $|I| = k$ 个质因子中选 $j\,(0 \le j \le k)$ 个。当选出奇数个时，对答案有 $-1$ 的贡献；当选出偶数个时，对答案有 $1$ 的贡献。

&emsp;&emsp;由于在 $k > 0$ 时，选奇数个和选偶数个的方案数是一样的，所以当 $n > 1$ 时，答案为 0。

&emsp;&emsp;以上结论用二项式定理来证明：
$$
(1 - 1)^k = C(k, 0) (-1)^0 + C(k, 1)(-1)^1 + \, ... + C(k, k) (-1)^k
$$
&emsp;&emsp;不难发现，上式的意义就是我们要求的答案。所以答案为 0。

###### ②使用积性证明

​	当 $n = p^r$ 时，有
$$
\sum _{d \mid p^r} \mu(d) = \mu(1) + \mu(p) + \mu(p^2) + \cdots + \mu(p^r) = 0
$$
&emsp;&emsp;由积性，当 $n \ne 1$ 时，原式也等于 0。

&emsp;&emsp;得证！

#####2. 莫比乌斯反演 

######①定义

&emsp;&emsp;前面已经提到过莫比乌斯变换。
$$
F(n) = \sum _{d \mid n} f(d)
$$
&emsp;&emsp;已经证明了它的积性：若 $f$ 为积性函数，那么 $F$ 也为积性函数。

&emsp;&emsp;上式是使用 $f$ 表示 $F$ 的。用上式的方法表示 $F$，我们称为 $f$ 的莫比乌斯变换。

&emsp;&emsp;如果已知用 $f$ 表示 $F$ 的公式，我们要**用 $F$ 表示 $f$，这个过程称为反演。**

&emsp;&emsp;如果我们已知上式，可以得到下式：
$$
f(n) = \sum _{d \mid n} \mu(d) F(\frac {n} {d})
$$
&emsp;&emsp;**对这个式子而言，称 $f$ 为 $F$ 的莫比乌斯逆变换。在用 $F$ 表示 $f$ 的过程中用到了 $\mu$ 的过程，统称为莫比乌斯反演。**

&emsp;&emsp;需要注意的是，上式（莫比乌斯逆变换）只是莫比乌斯反演的**其中一种**，因为用到了莫比乌斯函数的反演都可以被称为莫比乌斯反演。了解到这一点后对理解其它资料会有很大帮助。

###### ②证明

$$
F(n) = \sum _{d \mid n} f(d)
\\
f(n) = \sum _{d \mid n} \mu(d) F(\frac {n} {d})
$$

&emsp;&emsp;第一个等式成立的充要条件是第二个等式成立，也就是说它们是可以互相推导的。

&emsp;&emsp;这里我们证明第一个等式成立的必要条件，即证明由第二个等式推导出第一个等式是正确的。

>    证明
>
>    &emsp;&emsp;设第一个等式成立。
>    $$
>    \sum _{d \mid n} \mu(d) F(\frac {n} {d})
>    =
>    \sum _{d \mid n} \mu(d) \sum _{l \mid \frac {n} {d}} f(l)
>    =
>    \sum _{l \mid n} f(l) \sum _{d \mid \frac {n} {l}} \mu(d)
>    =
>    f(n)
>    $$
>    &emsp;&emsp;~~只给一行式子鬼才看得懂。~~
>
>    &emsp;&emsp;第一步由第一个等式成立推出，显然。
>
>    &emsp;&emsp;第二步需要考虑 $f(l)$ 在何时被计算，然后考虑计算贡献。当 $l \mid \frac {n} {d}$ 时，$f(l)$ 将会有 $\mu(d)$ 的贡献，也就是说，**当 $d \mid \frac {n} {l}$ 时，$f(l)$ 将会有 $\mu(d)$ 的贡献**。因此第二步得证。
>
>    &emsp;&emsp;第三步考虑莫比乌斯等式。仅当 $l = n$ 时，$\sum _{d \mid \frac {n} {l}} \mu(d) = 1$，其余情况等于 $0$。因此第三步得证。
>
>    &emsp;&emsp;得证！

>   &emsp;&emsp;考虑使用 Dirichlet 卷积证明充分性和必要性。
>   $$
>   F = f * 1
>   \\
>   \mu * F = f * \mu * 1
>   \\
>   \mu * F  = f * \epsilon
>   \\
>   f = \mu * F
>   $$
>   &emsp;&emsp;得证！

###### ③另一种常见的莫比乌斯反演

$$
F_m(n) = \sum_{i = 1}^{\lfloor \frac {m} {n} \rfloor}f_m(i·n)
\\
f_m(n) = \sum _{i = 1}^{\lfloor \frac {m} {n} \rfloor}\mu(i) · F_m(i · n)
$$

&emsp;&emsp;其中，$m$ 可以理解为一个给定的变量。称式（2）为式（1）的反演。

&emsp;&emsp;我们同样只证明第二个式子。

>证明
>
>&emsp;&emsp;设第一个等式成立。
>$$
>\sum _{i = 1} ^{\lfloor \frac {m} {n} \rfloor} \mu(i) · F_m(i · n)
>=
>\sum _{i = 1} ^{\lfloor \frac {m} {n} \rfloor} \mu(i) ·
>\sum _{j = 1} ^{\lfloor \frac {m} {i · n} \rfloor} f(i · j · n)
>=
>\sum _{i = 1} ^{\lfloor \frac {m} {n} \rfloor} f(i · n) ·
>\sum _{d \mid i} \mu(d)
>= f(n)
>$$
>&emsp;&emsp;~~只给一行式子鬼才看得懂。~~
>
>&emsp;&emsp;第一步由第一个等式成立推出，显然。
>
>&emsp;&emsp;第二步需要考虑 $f(i · j · n)$ 在何时被计算，然后考虑计算贡献。在第三个式子中，$i$ 相当于第二个式子中的 $i · j$。相当于是当 $i$ 可以被分解成两个数相乘时，$f(i · n)$ 将会有 $\mu(d)$ 的贡献。第二步得证。
>
>&emsp;&emsp;第三步同样考虑莫比乌斯等式。
>
>​&emsp;&emsp;得证！

