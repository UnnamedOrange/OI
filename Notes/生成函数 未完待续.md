[TOC]

# 生成函数

##基础

##### 1. 泰勒公式

&emsp;&emsp;当 $x \to x_0$ 时：
$$
f(x) = f(x_0) +
\frac {f'(x_0)} {1!} (x - x_0) +
\frac {f^{(2)}(x_0)} {2!} (x - x_0)^2 +
\cdots +
\frac {f^{(n)}(x_0)} {n!} (x - x_0)^n +
o((x - x_0)^n)
$$
&emsp;&emsp;当 $x_0 = 0$ 时：
$$
f(x) = 
f(0) +
\frac {f'(0)} {1!} x +
\frac {f^{(2)}(0)} {2!} x^2 +
\cdots +
\frac {f^{(n)}(0)} {n!} x^n +
o(x^n)
$$

##### 2. 泰勒展开的例子

$$
(e^x)^{(n)} = e^x
\\
e^x =
1 + \frac {x} {1!} + \frac {x^2} {2!} + \frac {x^3} {3!}
+ \cdots + \frac {x^n} {n!} + \cdots
$$

$$
\sin(x) = x - \frac {x^3} {3!}
+ \frac {x^5} {5!}
+ \cdots
+ (-1)^n \frac {x^{2n + 1}} {(2n + 1)!}
+ \cdots
$$

$$
\cos(x) = 1 - \frac {x^2} {2!}
+ \frac {x^4} {4!}
+ \cdots
+ (-1)^n \frac {x^{2n}} {(2n)!}
+ \cdots
$$

$$
\ln(1 + x) = \frac {x} {1}
- \frac {x^2} {2}
+ \frac {x^3} {3}
+ \cdots
+ (-1)^{n + 1} \frac {x^n} {n}
+ \cdots
$$

$$
(1 + x)^a = 1 + \frac {a} {1!} x
+ \frac {a(a - 1)} {2!} x^2
+ \cdots
+ \frac {a (a - 1) \cdots (a - n + 1)} {n!} x^n
+ \cdots
$$

## 普通生成函数

####基础

##### 1. 定义

&emsp;&emsp;我们有一个序列 $\{ a_n, a_1, a_2, a_3, \cdots \}$，希望能将它们整体表示出来。除了直接写出这个序列，还可以这样做：将序列元素作为系数，放在函数里：
$$
A(x) = \sum_{k = 0}^{\infty} a_k x^k
$$
&emsp;&emsp;称 $A(x)$ 为序列的普通生成函数。

##### 2. 例子

&emsp;&emsp;最常见的 Taylor 公式：
$$
e^x = 1 + x + \frac {x^2} {2} + \frac {x^3} {6} + \frac {x^4} {24}
+ \cdots + \frac {x^n} {n!} + \cdots
$$
&emsp;&emsp;所以 $e^x$ 可以表示：
$$
1, 1, \frac {1} {2}, \frac {1} {6}, \frac {1} {24},
\cdots, \frac {1} {n!}, \cdots
$$

##### 3. 全是 $1$ 的序列

&emsp;&emsp;可以用 $1 + x + x^2 + x^3 + \cdots$ 表示全部是 $1$ 的序列。那对于这个多项式，有没有什么化简的办法呢？

&emsp;&emsp;设 $S = 1 + x + x^2 + x^3 + \cdots$，有：
$$
\begin{align}
S = 1 + &x + x^2 + x^3 + \cdots
\\
-xS = -(&x + x^2 + x^3 + \cdots)
\end{align}
$$
&emsp;&emsp;易得：
$$
(1 - x)S = 1
$$
&emsp;&emsp;即：
$$
S = \frac {1} {1 - x}
$$
&emsp;&emsp;于是我们可以用 $\frac {1} {1 - x}$ 表示全部是 $1$ 的序列。

------

&emsp;&emsp;可以对 $\frac {1} {1 - x} = (1 - x)^{-1}$ 进行泰勒展开：
$$
(1 - x)^a =
1 - \frac {a} {1!} x + \frac {a(a - 1)} {2!}x^2
- \frac {a(a - 1)(a - 2)} {3!} x^3
+ \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {1} {1 - x}
= 1 + x + x^2 + x^3 + \cdots
$$

##### 4. 等比数列

&emsp;&emsp;既然 $\frac {1} {1 - x}$ 代表全是 $1$ 的序列，那 $\frac {1} {1 + x}$ 呢？
$$
(1 + x)^a = 1 + \frac {a} {1!} x
+ \frac {a(a - 1)} {2!} x^2
+ \frac {a(a - 1)(a - 2)} {3!} x^3
+ \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {1} {1 + x}
= 1 - x + x^2 - x^3 + \cdots
$$
&emsp;&emsp;所以 $\frac {1} {1 + x}$ 代表的序列为：
$$
1, -1, 1, -1, \cdots
$$

------

&emsp;&emsp; $\frac {1} {1 - 3x}$ 代表什么呢？
$$
(1 - 3x)^a = 1 - \frac {3a} {1!} x
+ \frac {27a(a - 1)} {2!}
- \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {1} {1 - 3x} = 1 + 3x + 27x^2 + \cdots
$$
&emsp;&emsp;得到的序列为：
$$
1, 3, 9, 27, 
\cdots, 3^n, \cdots
$$

------

&emsp;&emsp;$\frac {2} {1- x}$ 代表什么呢？
$$
2(1-x)^a = 2 - \frac {2a} {1!} x
+ \frac {2a(a - 1)} {2!}
- \frac {2a(a - 1)(a - 2)} {3!}
+ \cdots
$$
&emsp;&emsp;代入 $a = -1$ 得：
$$
\frac {2} {1 - x} = 2 + 2x + 2x^2 + 2x^3 + \cdots
$$
&emsp;&emsp;得到的序列为：
$$
2, 2, 2, 2, \cdots
$$

------

&emsp;&emsp;**一般地，对于一个首项为 $a$，公比为 $q$ 的等比数列，它的生成函数为：**
$$
A = \frac {a} {1 - qx}
$$

##### 5. 每两个数之间存在 $k$ 个 $0$ 的序列

&emsp;&emsp;对于序列：
$$
1, 0, 1, 0, 1, 0, \cdots
$$
&emsp;&emsp;可以得到它的生成函数：
$$
A = 1 + x^2 + x^4 + x^6 + \cdots
$$
&emsp;&emsp;同乘以 $x^2$ 得到：
$$
x^2 A = x^2 + x^4 + x^6 + \cdots
$$
&emsp;&emsp;相减得：
$$
(1 - x^2) A = 1
\\
A = \frac {1} {1 - x^2}
$$

------

&emsp;&emsp;对于序列：
$$
1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, \cdots
$$

$$
A = 1 + x^4 + x^8 + \cdots
\\
x^4 A = x^4 + x^8 + \cdots
\\
A = \frac {1} {1 - x^4}
$$

&emsp;&emsp;**一般地，对于一个第一个数为 $1$，每两个 $1$ 之间存在 $k$ 个 $0$ 的 $01$ 序列，它的生成函数为：**
$$
A = \frac {1} {1 - x^{k + 1}}
$$

##### 6. 在序列前补 $0$

&emsp;&emsp;要在序列前补$k$ 个 $0$，只需要让生成函数乘以 $x^k$：
$$
A = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \cdots
\\
x^2 A = 0 + 0 x + a_0 x^2 + a_1 x^3 + a_2 x^4 + \cdots
$$

------

&emsp;&emsp;**一般地，对于一个首项为 $a$，公比为 $q$ 的等比数列，每个数之间插入了 $k$ 个 $0$，在序列的最前面插入了 $t$ 个 $0$，则它的生成函数为：**
$$
A = x^t \frac {a} {1 - q x^{k + 1}}
$$

#####7. 生成函数的加法 

$$
\frac {1} {1 - x^2} + \frac {x} {1 - x^2} = \frac {1} {1 - x}
$$

$$
\begin {align}
&~1, 0, 1, 0, 1, 0, \cdots
\\
+&~0, 1, 0, 1, 0, 1, \cdots
\\
=&~1, 1, 1, 1, 1, 1, \cdots
\end {align}
$$

&emsp;&emsp;生成函数可以进行加法运算，实质上是多项式加法。

#####8. 生成函数的前缀和与差分

&emsp;&emsp;如果有生成函数 $A$：
$$
A = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \cdots
$$
&emsp;&emsp;可以做如下变换：
$$
A = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \cdots
\\
xA = 0 + a_0 x + a_1 x^2 + a_2 x^3 + \cdots
\\
(1 - x)A = (a_0 - 0)  + (a_1 - a_0)x + (a_2 - a_1)x^2 + (a_3 - a_2)x^3 + \cdots
$$
&emsp;&emsp;**即：对于生成函数，乘以一个 $(1 - x)$ 相当于做了一次差分，除以一个 $(1 - x)$ 相当于做了一次前缀和。**

&emsp;&emsp;**特别地，对于生成函数，除以一个 $(1 - x^{k + 1})$ 相当于每个数与它前面的倒数第 $k$ 个数做前缀和。**

------

&emsp;&emsp;e.g. 求完全平方数的生成函数 $1, 4, 9, 16, \cdots$

&emsp;&emsp;解：对完全平方数做差分，我们有：
$$
1, 3, 5, 7, \cdots
$$
&emsp;&emsp;再做差分，我们有：
$$
1, 2, 2, 2, \cdots
$$
&emsp;&emsp;再做差分，我们有：
$$
1, 1, 0, 0, \cdots
$$
&emsp;&emsp;易得该序列的生成函数为 $1 + x$。即原序列的生成函数为 $\frac {1 + x} {(1 - x)^3}$。

##### 9. 练习

$$
4, 4, 4, 4, 4, \cdots \tag{1}
$$

$$
A = \frac {4} {1 - x}
$$


$$
2, 4, 6, 8, 10, \cdots \tag {2}
$$

$$
A = \frac {2} {(1 - x)^2}
$$


$$
0, 0, 0, 2, 4, 6, 8, 10, \cdots \tag {3}
$$

$$
A = \frac {2x^3} {(1 - x)^2}
$$


$$
1, 5, 25, 125, \cdots \tag {4}
$$

$$
A = \frac {1} {1 - 5x}
$$


$$
1, -3, 9, -27, 81, \cdots \tag{5}
$$

$$
A = \frac {1} {1 + 3x}
$$


$$
1, 0, 5, 0, 25, 0, 125, 0, \cdots \tag {6}
$$

$$
A = \frac {1} {1 - 5x^2}
$$

$$
0, 1, 0, 0, 2, 0, 0, 3, 0, 0, 4, 0, 0, 5, \cdots \tag{7}
$$

$$
A = \frac {x} {(1 - x^3)^2}
$$

$$
4, 5, 7, 10, 14, 19, 25, \cdots \tag {8}
$$

$$
A = \frac {4} {1 - x} + \frac {x} {(x - 1)^3}
$$

##### 10. 线性递推式的生成函数

&emsp;&emsp;根据斐波那契数列的定义，我们有：
$$
a_n = a_{n - 1} + a_{n - 2}
$$
&emsp;&emsp;可以写出它的生成函数：
$$
\begin{gather}
A = 1 + 1x + 2x^2 + 3x^3 + 5x^4 + 8x^5 + \cdots
\\
xA = 0 + 1x + 1x^2 + 2x^3 + 3x^4 + 5x^5 + \cdots
\\
-x^2A = 0 + 0x + 1x^2 + 1x^3 + 2x^4 + 3x^5 + \cdots
\\
(1 - x - x^2)A = 1
\\
A = \frac {1} {1 - x - x^2}
\end{gather}
$$

------

&emsp;&emsp;e.g. 求 $a_n = 3a_{n - 1} - 2a_{n - 2}$ 的生成函数。其中 $a_0 = 1$，$a_1 = 3$。

&emsp;&emsp;解：
$$
A = \frac {1} {1 - 3x + 2x^2}
$$

#### 普通生成函数与组合计数问题

##### 1. 加法原理和乘法原理

&emsp;&emsp;将 $i$ 次项系数 $a_i$ 看作组合问题中选取问题规模为 $i$ 的方案数。则对于两个普通生成函数的加法，则对应加法原则：
$$
C = A + B = \sum_{n = 0}^{\infty} (a_n + b_n)x^n
$$
&emsp;&emsp;对于生成函数的乘法，对应乘法原则：
$$
C = A × B = \sum_{n = 0}^{\infty} (\sum_{i = 0}^{n} (a_i × b_{n - i}))
$$
&emsp;&emsp;**普通生成函数适用于无标号的计数问题。**

------

&emsp;&emsp;e.g. 有 A，B，C，D 四种水果，每种水果都有无限个。现在要求每种水果拿若干个，要求 A 恰好拿出偶数个，B 恰好拿出 5 的倍数个，C 最多拿 4 个，D 最多拿 1 个，如果最后恰好拿出 $n$ 个水果，有多少种方案。

&emsp;&emsp;解：设 $G$ 为方案数的生成函数，A，B，C，D 分别为只拿某种水果的生成函数，则有：
$$
A = \frac {1} {1 - x^2}
\\
B = \frac {1} {1 - x^5}
\\
C = 1 + x + x^2 + x^3 + x^4
\\
D = 1 + x
$$

$$
G = A × B × C × D
\\
G = \frac {1} {1 - x^2} · \frac {1} {1 - x^5} · \frac {1 - x^5} {1 - x} · (1 - x)
=
\frac {1} {(1 - x)^2}
$$

&emsp;&emsp;即 $G$ 对应的序列为 $1, 2, 3, 4, 5, \cdots$，所以恰好选取 $n$ 个水果的方案数为 $n + 1$。

##### 2. 卡特兰数

&emsp;&emsp;一个正 $n$ 边形，画 $n - 3$ 条不相交的对角线将它划分成一些三角形，有多少种方案？

&emsp;&emsp;方案数被称为 Catalan 数，前几项为 $1, 2, 5, 14, 42, \cdots$。

###### ①递推式

$$
c_n = \sum_{i = 0}^{n - 1} c_i c_{n - i - 1}
$$

&emsp;&emsp;这是一个非线性的递推式，其生成函数为：
$$
G(x) = 1 + 1 x + 2 x^2 + 5 x^3 + 14 x^4 + 42 x^5 + \cdots
$$

######②生成函数

&emsp;&emsp;注意到，卡特兰数的递推式是一个类似于卷积的东西，而多项式乘法也是一个卷积。设多项式次数为 $n$ 的项的系数为 $c_n$，则当多项式相乘时，对于 $c_n$ 有：